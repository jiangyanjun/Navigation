
@{
    Layout = null;
    ViewBag.Title = "科布尔管理系统";
    ViewBag.Keyword = "科布尔 是科技社区";
    ViewBag.Description = "科布尔 让人人都成为老司机";
}

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>UrlTypeManager</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="">
    <meta name="description" content="">

    <link href="~/Content/Admin/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/Content/Admin/css/font-awesome.css" rel="stylesheet">
    <link href="~/Content/Admin/css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="~/Content/Admin/css/animate.css" rel="stylesheet">
    <link href="~/Content/Admin/css/style.css" rel="stylesheet">
</head>
<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    @*<div class="ibox-title">
                            <h5>自定义响应式表格</h5>
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-up"></i>
                                </a>
                                <a class="dropdown-toggle" data-toggle="dropdown" href="table_basic.html#">
                                    <i class="fa fa-wrench"></i>
                                </a>
                                <ul class="dropdown-menu dropdown-user">
                                    <li>
                                        <a href="table_basic.html#">选项1</a>
                                    </li>
                                    <li>
                                        <a href="table_basic.html#">选项2</a>
                                    </li>
                                </ul>
                                <a class="close-link">
                                    <i class="fa fa-times"></i>
                                </a>
                            </div>
                        </div>*@
                    <div class="ibox-content">
                        @*<div class="row">
                                <div class="col-sm-5 m-b-xs">
                                    <select class="input-sm form-control input-s-sm inline">
                                        <option value="0">请选择</option>
                                        <option value="1">选项1</option>
                                        <option value="2">选项2</option>
                                        <option value="3">选项3</option>
                                    </select>
                                </div>
                                <div class="col-sm-4 m-b-xs">
                                    <div data-toggle="buttons" class="btn-group">
                                        <label class="btn btn-sm btn-white">
                                            <input type="radio" id="option1" name="options">天
                                        </label>
                                        <label class="btn btn-sm btn-white active">
                                            <input type="radio" id="option2" name="options">周
                                        </label>
                                        <label class="btn btn-sm btn-white">
                                            <input type="radio" id="option3" name="options">月
                                        </label>
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <div class="input-group">
                                        <input type="text" placeholder="请输入关键词" class="input-sm form-control"> <span class="input-group-btn">
                                            <button type="button" class="btn btn-sm btn-primary"> 搜索</button>
                                        </span>
                                    </div>
                                </div>
                            </div>*@
                        <div class="table-responsive">
                            <table class="table table-striped" id="tbTypesData">
                                <thead>
                                    <tr>
                                        <th>序号</th>
                                        <th>状态</th>
                                        <th>名称</th>
                                        <th>优先级（降序）</th>
                                        <th>操作</th>
                                        <th>网址数量</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>




    <!-- 模态框（Modal） -->
    <div class="modal fade" id="myTypesEditModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        名称 状态修改
                    </h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal">
                        <div class="form-group has-success">
                            <label class="col-sm-4 control-label">类型名称：</label>
                            <div class="col-sm-8">
                                <input type="text" id="txtName" class="form-control">
                            </div>
                        </div>
                        <div class="form-group has-success">
                            <label class="col-sm-4 control-label">状态：</label>
                            <div class="col-sm-8">
                                <select class="form-control m-b" id="txtStatus" name="account">
                                    <option value="正常">正常</option>
                                    <option value="无效">无效</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group has-success">
                            <label class="col-sm-4 control-label">排序优先级：</label>
                            <div class="col-sm-8">
                                <input type="number" id="txtSort" class="form-control">
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <div class="col-sm-4 col-sm-offset-2">
                                <input type="hidden" id="hidId" />
                                <button class="btn btn-primary" type="button" onclick="UpdateTypesSave()">保存内容</button>&nbsp;&nbsp;&nbsp;&nbsp;
                                <button class="btn btn-white" type="submit">取消</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
    <div class="modal fade" id="myModifyModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        类型里面Url 修改
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-6">
                            <p id="m_p_2"><select class="form-control selectpicker" data-style="btn-success" id="mySelectRight"></select></p>
                        </div>
                        <div class="col-xs-6">
                            <p id="m_p_3"><select class="form-control selectpicker" data-style="btn-danger" id="mySelectLeft"></select></p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-6">
                            <button type="button" id="undo_redo_rightSelected" class="btn btn-primary btn-block"><i class="glyphicon glyphicon-chevron-down"></i></button>
                        </div>
                        <div class="col-xs-6">
                            <button type="button" id="undo_redo_leftSelected" class="btn btn-warning btn-block"><i class="glyphicon glyphicon-chevron-up"></i></button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <select name="from[]" id="undo_redo" class="form-control" size="13" multiple="multiple"></select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <select name="to[]" id="undo_redo_to" class="form-control" size="13" multiple="multiple"></select>
                        </div>
                    </div>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
    <!-- 全局js -->
    <script src="~/Content/Admin/js/jquery.min.js"></script>
    <script src="~/Content/Admin/js/bootstrap.min.js"></script>

    <!-- Peity -->
    <script src="~/Content/Admin/js/plugins/peity/jquery.peity.min.js"></script>
    <!-- 自定义js -->
    <script src="~/Content/Admin/js/content.js"></script>

    <!-- iCheck -->
    <script src="~/Content/Admin/js/plugins/iCheck/icheck.min.js"></script>
    <!-- Peity -->
    <script src="~/Content/Admin/js/demo/peity-demo.js"></script>
    <script>
        $(document).ready(function () {
            $('.i-checks').iCheck({
                checkboxClass: 'icheckbox_square-green',
                radioClass: 'iradio_square-green',
            });
            LoadData();
            //$('#mySelectLeft').change(function () {
            //    var p = $(this).children('option:selected').val();
            //    $("#mySelectLeft option[value=" + p + "]").remove();
            //})

            //左右加减
            $("#undo_redo_rightSelected").click(function () {
                var arryList = new Array();
                for (var i = 0; i < $("#undo_redo option:selected").length; i++) {
                    arryList[i] = $("#undo_redo option:selected").eq(i).val();
                }
                if (arryList != null && arryList.length > 0) {
                    $("#undo_redo option:selected").appendTo("#undo_redo_to");
                    $.ajax({
                        url: '/AJAXRequestAPI/UrlTypeUpdate', type: 'post', data: { arryList: arryList, toId: $("#mySelectLeft").children('option:selected').val() },
                        success: function (data) { }, error: function (error) { }
                    });
                } else alert('请先选择要移动到的目的地');
            });
            $("#undo_redo_leftSelected").click(function () {
                var arryList = new Array();
                for (var j = 0; j < $("#undo_redo_to  option").length; j++) {
                    arryList[j] = $("#undo_redo_to  option").eq(j).val();
                }
                if (arryList != null && arryList.length > 0) {
                    $("#undo_redo_to option:selected").appendTo("#undo_redo");
                    $.ajax({
                        url: '/AJAXRequestAPI/UrlTypeUpdate', type: 'post',
                        data: { arryList: arryList, toId: $("#mySelectRight").children('option:selected').val() },
                        success: function (data) { }, error: function (error) { }
                    });
                } else alert('请先选择要移动到的目的地');
            });


        });
        function LoadData() {
            var html = "";
            $("#tbTypesData tbody").html("");
            var url = "/Content/Ajax/HandlerServices.ashx?method=gettypedata";
            $.getJSON("" + url, function (data) {
                $("#mySelectLeft").append("<option value=\"\"></option>");
                $.each(data, function (index, item) {
                    var selectHtml = "<option value=" + item.Id + ">" + item.Name + "</option>";
                    $("#mySelectLeft").append(selectHtml);
                    html += "<tr><td>" + index + "</td><td>" + item.Status + "</td><td><a onclick=\"CliclTypeA('" + item.Id + "','" + item.Name + "','" + item.Status + "','" + item.SortDesc + "')\">" + item.Name + "</a></td><td>" + item.SortDesc + "</td><td> <a onclick=\"UrlModify('" + item.Id + "','" + item.Name + "')\">网址类型维护</a></td><td>" + item.UrlCount + "</td></tr>";
                });
                $("#tbTypesData tbody").append(html);
            });
        }
        function UrlModify(p, p2) {
            $("#mySelectRight").append("<option value=" + p + ">" + p2 + "</option>");
            $("#mySelectLeft option[value=" + p + "]").remove();
            var parameter = "&key=" + p;
            var url = "/Content/Ajax/HandlerServices.ashx?method=geturlentity";
            $.getJSON("" + url + parameter, function (data) {
                var htmlConternt = "";
                $(data).each(function (i, item) {
                    htmlConternt += "<option value='" + item.Id + "'>" + item.Name + " 》 " + item.Url + "</option>"
                });
                $("#undo_redo").html(htmlConternt);
            })

            $('#myModifyModal').modal('show');
        }
        function CliclTypeA(id, name, status, sort) {
            $("#txtName").val(name);
            $("#hidId").val(id);
            $("#txtStatus").val(status);
            $("#txtSort").val(sort)
            $('#myTypesEditModal').modal('show');
        }
        function UpdateTypesSave() {
            var name = $("#txtName").val();
            var status = $("#txtStatus").val();
            var id = $("#hidId").val();
            if (name == null || name == undefined || name == "" || name.length < 1) {
                alert("类型名不可为空");
                return;
            } if (status == null || status == undefined || status == "" || status.length < 1) {
                alert("类型状态不可为空");
                return;
            } if (id == null || id == undefined || id == "" || id.length < 1) {
                alert("Id不可为空");
                return;
            }
            $.post("/AJAXRequestAPI/UpdateType", { Name: name, Status: status, Id: id, Sort: $("#txtSort").val() }, function (result) {
                alert(result);
                LoadData();
                $('#myTypesEditModal').modal('hide');
            });
        }
    </script>


</body>
</html>
